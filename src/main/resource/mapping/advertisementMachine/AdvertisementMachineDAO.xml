<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xmlan.machine.module.advertisementMachine.dao.AdvertisementMachineDAO">

    <resultMap id="advertisementMachineResultMap"
               type="com.xmlan.machine.module.advertisementMachine.entity.AdvertisementMachine">
        <id column="id" property="id"/>
        <result column="userID" property="userID"/>
        <result column="name" property="name"/>
        <result column="address" property="address"/>
        <result column="longitude" property="longitude"/>
        <result column="latitude" property="latitude"/>
        <result column="addTime" property="addTime"/>
        <result column="codeNumber" property="codeNumber"/>
        <result column="light" property="light"/>
        <result column="charge" property="charge"/>
        <result column="checked" property="checked"/>
        <result column="remark" property="remark"/>
    </resultMap>

    <sql id="columns">
        t.id as "id",
        t.userID as "userID",
        t.name as "name",
        t.address as "address",
        t.longitude as "longitude",
        t.latitude as "latitude",
        date_format(t.addTime, '%Y-%m-%d %H:%i:%s') as "addTime",
        t.codeNumber as "codeNumber",
        t.light as "light",
        t.charge as "charge",
        t.checked as "checked",
        t.remark as "remark"
    </sql>

    <select id="get" parameterType="java.lang.String" resultMap="advertisementMachineResultMap">
        select
        <include refid="columns"/>
        from advertisement_machine t
        where t.id = #{id}
    </select>

    <select id="findAll" resultMap="advertisementMachineResultMap">
        select
        <include refid="columns"/>
        from advertisement_machine t
        order by t.addTime, convert(t.name using gbk) asc
    </select>

    <select id="findList" parameterType="com.xmlan.machine.module.advertisementMachine.entity.AdvertisementMachine"
            resultMap="advertisementMachineResultMap">
        select
        <include refid="columns"/>
        from advertisement_machine t
        <where>
            <if test="userID != null and userID != ''">
                t.userID = #{userID}
            </if>
            <if test="name != null and name != ''">
                and t.name like concat('%',#{name},'%')
            </if>
            <if test="address != null and address != ''">
                and t.address like concat('%',#{address},'%')
            </if>
            <if test='addTime != null and addTime != "" and addTime != " "'>
                and t.addTime between #{addTime} and concat(left(#{addTime}, 10), ' 23:59:59')
            </if>
            <if test='codeNumber != null and codeNumber != ""'>
                and t.codeNumber = #{codeNumber}
            </if>
            <if test="remark != null and remark != ''">
                and t.remark like concat('%',#{remark},'%')
            </if>
            <if test="longitude != null and longitude != ''">
                and t.longitude = #{longitude}
            </if>
            <if test="latitude != null and latitude != ''">
                and t.latitude = #{latitude}
            </if>
        </where>
        <choose>
            <otherwise>
                order by t.addTime, convert(t.name using gbk) asc
            </otherwise>
        </choose>
    </select>

    <insert id="insert" parameterType="com.xmlan.machine.module.advertisementMachine.entity.AdvertisementMachine">
        insert into advertisement_machine (
        id,
        userID,
        name,
        address,
        longitude,
        latitude,
        addTime,
        codeNumber,
        light,
        charge,
        checked,
        remark
        ) values (
        id,
        #{userID},
        #{name},
        #{address},
        #{longitude},
        #{latitude},
        #{addTime},
        #{codeNumber},
        0,
        0,
        0,
        #{remark}
        );
    </insert>

    <update id="update" parameterType="com.xmlan.machine.module.advertisementMachine.entity.AdvertisementMachine">
        update advertisement_machine
        set
        userID = #{userID},
        name = #{name},
        address = #{address},
        remark = #{remark}
        where id = #{id}
    </update>

    <delete id="delete" parameterType="com.xmlan.machine.module.advertisementMachine.entity.AdvertisementMachine">
        delete from advertisement_machine
        where id = #{id}
    </delete>

    <select id="findAllADMachineByUser" resultMap="advertisementMachineResultMap">
        select
        <include refid="columns"/>
        from advertisement_machine t
        where userID = #{userID}
    </select>

    <select id="getByCodeNumber" resultMap="advertisementMachineResultMap">
        select
        <include refid="columns"/>
        from advertisement_machine t
        where codeNumber = #{codeNumber}
    </select>

    <update id="updateLocation">
        update advertisement_machine
        set
        longitude = #{longitude},
        latitude = #{latitude}
        where id = #{id}
    </update>

    <update id="lightControl">
        update advertisement_machine
        set light = #{operate}
        where id = #{id}
    </update>

    <update id="chargeControl">
        update advertisement_machine
        set charge = #{operate}
        where id = #{id}
    </update>

    <update id="checkedControl">
        update advertisement_machine
        set checked = #{operate}
        where id = #{id}
    </update>

</mapper>